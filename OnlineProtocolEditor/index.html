<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Online Protocol Editor</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <h1>Pocket Lab App - Online Protocol Editor</h1>
      <p class="tagline">Edit, validate, and share PoLA protocol files directly in your browser.</p>
    </header>

    <main class="app-layout">
      <section class="editor-panel">
        <div class="toolbar" role="toolbar" aria-label="Protocol actions">
          <button id="newButton" class="primary" type="button">New</button>
          <button id="loadButton" type="button">Load…</button>
          <button id="saveButton" type="button">Save</button>
          <button id="downloadButton" type="button">Download</button>
          <button id="templatesButton" type="button">Templates</button>
          <div role="separator" class="toolbar-divider" aria-hidden="true"></div>
          <button id="aboutButton" type="button" class="link-button">About</button>
          <button id="manualButton" type="button" class="link-button">Manual</button>
          <div class="toolbar-spacer"></div>
          <label class="checkbox" for="autoValidate">
            <input id="autoValidate" type="checkbox" checked />
            Auto validate
          </label>
        </div>
        <div id="commandSuggestion" class="suggestion-bar" role="status" aria-live="polite"></div>
        <div class="inline-action-row">
          <button id="insertButton" type="button" class="primary">Insert Command</button>
        </div>
        <div class="protocol-input-wrapper">
          <pre id="protocolGhost" class="protocol-ghost" aria-hidden="true"><span class="ghost-prefix"></span><span class="ghost-suggestion"></span></pre>
          <textarea
            id="protocolInput"
            aria-label="Protocol contents"
            spellcheck="false"
            placeholder="Start typing your protocol here…"
          ></textarea>
        </div>
        <footer class="editor-footer">
          <span id="lineCount" aria-live="polite">0 lines</span>
          <span id="statusText" aria-live="polite"></span>
          <span id="unsavedIndicator" class="status-pill warning" hidden>Unsaved changes</span>
        </footer>
      </section>

      <aside class="inspector-panel">
        <section class="card" id="validationCard">
          <header class="card-header">
            <h2>Validation</h2>
            <div class="card-actions">
              <button id="validateButton" type="button">Validate now</button>
            </div>
          </header>
          <div class="validation-controls">
            <input
              id="issueFilter"
              type="search"
              placeholder="Filter by text or line number"
              aria-label="Filter validation results"
            />
            <div class="issue-nav">
              <button id="prevIssue" type="button" aria-label="Previous issue">◀</button>
              <button id="nextIssue" type="button" aria-label="Next issue">▶</button>
            </div>
          </div>
          <div class="table-wrapper">
            <table id="validationTable">
              <thead>
                <tr>
                  <th scope="col">Line</th>
                  <th scope="col">Command</th>
                  <th scope="col">Error</th>
                  <th scope="col">Warning</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>

        <section class="card" id="commandsCard">
          <header class="card-header">
            <h2>Recognized commands</h2>
            <button id="toggleCommands" type="button" aria-expanded="false">Show all</button>
          </header>
          <div class="card-body" id="commandsBody" hidden>
            <p class="card-hint">Commands are case-insensitive. Tap any command to insert a template.</p>
            <div id="commandList" class="command-groups"></div>
          </div>
        </section>

        <section class="card" id="cheatsheetCard">
          <header class="card-header">
            <h2>Cheat sheet</h2>
          </header>
          <div class="card-body">
            <ul class="cheat-list">
              <li><strong>//</strong> starts a comment; comments are ignored when validating.</li>
              <li>Use semicolons to separate command segments.</li>
              <li>Use <code>LABEL;Name</code> + <code>GOTO;Name</code> for branching.</li>
              <li>
                Wrap optional values in brackets, e.g. <code>[Continue]</code> or <code>[Hold]</code>.
              </li>
              <li>
                Randomization uses balanced pairs of <code>RANDOMIZE_ON</code> and <code>RANDOMIZE_OFF</code>.
              </li>
            </ul>
          </div>
        </section>
      </aside>
    </main>

    <input id="fileInput" type="file" accept=".txt,text/plain" hidden />

    <dialog id="insertDialog">
      <form method="dialog" class="insert-form" novalidate>
        <header class="dialog-header">
          <h2 id="insertDialogTitle">Insert command</h2>
          <p id="insertDialogSubtitle" class="dialog-subtitle">
            Pick a command on the left, then configure its parameters before inserting it into the protocol.
          </p>
        </header>
        <div class="dialog-columns">
          <section class="command-picker" aria-label="Command list">
            <div class="picker-controls">
              <label class="field">
                Category
                <select id="insertCategory"></select>
              </label>
              <label class="field">
                Search
                <input id="insertSearch" type="search" placeholder="Search commands" />
              </label>
            </div>
            <ul id="insertCommandList" class="command-list" role="listbox"></ul>
          </section>
          <section class="command-config" aria-live="polite">
            <div class="config-header">
              <div>
                <p class="config-label">Selected command</p>
                <h3 id="selectedCommandName">None</h3>
              </div>
              <button id="clearCommandSelection" type="button" class="link-button" hidden>Clear</button>
            </div>
            <div id="configContent" class="config-content">
              <p id="configPlaceholder" class="config-placeholder">
                Choose a command to see its parameters and validation helpers.
              </p>
              <div id="configSections" hidden>
                <div id="commandHint" class="command-hint" aria-live="polite"></div>
                <div id="parameterContainer" class="parameter-container"></div>
              </div>
              <p id="insertDialogMessage" class="dialog-message" role="alert" hidden></p>
            </div>
          </section>
        </div>
        <footer class="dialog-footer">
          <button id="insertDialogCancel" value="cancel" type="button">Cancel</button>
          <div class="dialog-footer-gap"></div>
          <button id="insertDialogSubmit" value="confirm" type="submit" class="primary">Insert</button>
        </footer>
      </form>
    </dialog>

    <dialog id="templatesDialog">
      <form method="dialog" class="templates-form" novalidate>
        <header class="dialog-header">
          <h2 id="templatesDialogTitle">Protocol templates</h2>
          <p id="templatesDialogSubtitle" class="dialog-subtitle">
            Browse ready-to-run study examples. Pick one to insert into your protocol.
          </p>
        </header>
        <div class="dialog-columns templates-columns">
          <section class="command-picker" aria-label="Template list">
            <div class="picker-controls templates-controls">
              <label class="field">
                Search
                <input id="templatesSearch" type="search" placeholder="Search templates" />
              </label>
            </div>
            <ul id="templatesList" class="command-list" role="listbox"></ul>
          </section>
          <section class="command-config templates-config" aria-live="polite">
            <div class="config-header">
              <div>
                <p class="config-label">Selected template</p>
                <h3 id="selectedTemplateName">None</h3>
              </div>
              <button id="clearTemplateSelection" type="button" class="link-button" hidden>Clear</button>
            </div>
            <div id="templatesContent" class="config-content">
              <p id="templatesPlaceholder" class="config-placeholder">
                Choose a template to see the study outline and instructions.
              </p>
              <div id="templateDetail" hidden>
                <div id="templateSummary" class="command-hint" aria-live="polite"></div>
                <pre id="templatePreview" class="template-preview" aria-label="Template preview"></pre>
              </div>
              <p id="templatesDialogMessage" class="dialog-message" role="alert" hidden></p>
            </div>
          </section>
        </div>
        <footer class="dialog-footer">
          <button id="templatesDialogCancel" value="cancel" type="button">Cancel</button>
          <div class="dialog-footer-gap"></div>
          <button id="insertTemplateButton" value="confirm" type="submit" class="primary" disabled>Insert template</button>
        </footer>
      </form>
    </dialog>

    <dialog id="aboutDialog" class="content-dialog" aria-labelledby="aboutDialogTitle">
      <article class="content-surface">
        <header class="content-dialog-header">
          <div>
            <h2 id="aboutDialogTitle">About the Online Protocol Editor</h2>
            <p class="content-dialog-subtitle">Craft PoLA study scripts directly in your browser.</p>
          </div>
          <button id="aboutDialogClose" type="button" class="link-button">Close</button>
        </header>
        <div class="content-body about-content" tabindex="0">
          <header>
            <h1>About the PoLA Online Protocol Editor</h1>
            <p class="lead">A web companion to Pocket Lab App for building, validating, and sharing study protocols.</p>
            <table class="meta">
              <tr>
                <th>Purpose</th>
                <td>Author PoLA-compatible protocols anywhere and keep them in sync with the Android app.</td>
              </tr>
              <tr>
                <th>Developed by</th>
                <td><i>Łukasz D. Kaczmarek, PhD, Adam Mickiewicz University, Psychophysiology Laboratory</i></td>
              </tr>
              <tr>
                <th>License</th>
                <td>GNU GPLv3 — community contributions are welcome.</td>
              </tr>
            </table>
          </header>

          <section id="about-mission">
            <h2>Why the editor exists</h2>
            <p>The Online Protocol Editor lets researchers and facilitators design PoLA studies without installing additional software. Every keystroke edits the same plain-text format the Android app reads, so you can iterate in the browser, share drafts with collaborators, and deploy updates in minutes.</p>
            <p>It complements the Pocket Lab App by offering rich authoring support—templates, command wizards, validation, and inline documentation—before your protocol ever reaches a device.</p>
          </section>

          <section id="about-capabilities">
            <h2>Key capabilities</h2>
            <ul>
              <li><strong>Command-aware editing:</strong> Insert commands with guided forms, autocomplete, and context hints to avoid syntax slips.</li>
              <li><strong>Ready-made templates:</strong> Start from curated outdoor study flows and adapt them to your fieldwork in seconds.</li>
              <li><strong>Inline validation:</strong> Auto-validate on each change (or on demand) to catch missing labels, unpaired randomization blocks, and formatting issues.</li>
              <li><strong>Documentation at hand:</strong> Open the Manual and command reference without leaving the editor.</li>
              <li><strong>Accessible comments:</strong> Comment helpers and spacing utilities keep protocols readable for multidisciplinary teams.</li>
              <li><strong>Download &amp; share:</strong> Save directly to disk, export, or copy/paste into version control for collaboration.</li>
            </ul>
          </section>

          <section id="about-workflow">
            <h2>From browser to field devices</h2>
            <div class="callout">
              <strong>Deployment snapshot</strong>
              <p>Edit in the Online Protocol Editor, verify with validation tools, then move the exported text file onto your Android device running PoLA.</p>
            </div>
            <ul>
              <li><strong>Edit &amp; validate:</strong> Draft your study, run validation, and resolve warnings.</li>
              <li><strong>Export:</strong> Download the protocol (and any referenced assets) to a folder you can sync with Android.</li>
              <li><strong>Load on Android:</strong> In PoLA, choose <em>Load Protocol</em> and pick the exported file. Pair it with the correct resources folder, then start your session.</li>
            </ul>
          </section>

          <section id="about-community">
            <h2>Project ethos</h2>
            <p>PoLA is maintained as open-source software to encourage transparent research workflows. Contributions are welcome—whether you are proposing new commands, improving accessibility, translating UI strings, or documenting study templates.</p>
          </section>

          <section id="about-license">
            <h2>License &amp; data handling</h2>
            <p>Pocket Lab App is free software released under the <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GNU General Public License v3</a>. You are free to study, modify, and share it as long as derivative work stays under the same license and preserves attribution.</p>
            <p>The editor and Android app keep protocols and collected responses on the device you control; nothing is uploaded unless you explicitly export or sync it. Always review deployments for local ethics, privacy, and safety requirements.</p>
            <div class="callout">
              <strong>Reminder:</strong> PoLA is provided <em>as is</em> with no warranties. Validate your studies, supervise fieldwork, and contact <a href="mailto:lkacz@amu.edu.pl">lkacz@amu.edu.pl</a> before commercial or clinical use.</div>
          </section>

          <section id="about-contact">
            <h2>Contact</h2>
            <p>Questions, collaboration ideas, or bug reports are welcome at <a href="mailto:lkacz@amu.edu.pl">lkacz@amu.edu.pl</a>. For roadmap updates and issue tracking, visit the project repository: <a href="https://github.com/lkacz/PocketLabApp" target="_blank" rel="noopener">github.com/lkacz/PocketLabApp</a>.</p>
          </section>

          <footer>
            <p>Looking for guidance on running a study? Open the <strong>Manual</strong> for setup checklists, customization tips, and the complete command reference.</p>
          </footer>
        </div>
      </article>
    </dialog>

    <dialog id="manualDialog" class="content-dialog" aria-labelledby="manualDialogTitle">
      <article class="content-surface">
        <header class="content-dialog-header">
          <div>
            <h2 id="manualDialogTitle">Online Protocol Editor Manual</h2>
            <p class="content-dialog-subtitle">Author studies for PoLA and deploy them to Android devices.</p>
          </div>
          <button id="manualDialogClose" type="button" class="link-button">Close</button>
        </header>
        <div class="content-body manual-content" tabindex="0">
          <header>
            <h1 id="manualTop">Online Protocol Editor Manual</h1>
            <p class="tagline">Design, validate, and hand off PoLA scripts before launching them on Android.</p>
            <table class="meta">
              <tr>
                <th>Audience</th>
                <td>Researchers and protocol authors working in the Online Protocol Editor.</td>
              </tr>
              <tr>
                <th>Includes</th>
                <td>Editor workflow tips, collaboration guidance, Android deployment steps, and the complete command reference.</td>
              </tr>
              <tr>
                <th>Last updated</th>
                <td>September 2025</td>
              </tr>
            </table>
          </header>

          <nav class="quick-links" aria-label="Manual overview">
            <strong>Jump to:</strong>
            <ul>
              <li><a href="#manual-quickstart">Quick start</a></li>
              <li><a href="#manual-authoring">Editor essentials</a></li>
              <li><a href="#manual-saving">Save &amp; share</a></li>
              <li><a href="#manual-android">Run on Android</a></li>
              <li><a href="#manual-license">License &amp; data policy</a></li>
              <li><a href="#manual-command-reference">Command reference</a></li>
              <li><a href="#manual-support">Support</a></li>
            </ul>
          </nav>

          <section id="manual-quickstart">
            <h2>Quick start</h2>
            <p>Follow these steps to author a protocol from scratch or refine an existing one:</p>
            <ol>
              <li><strong>New or existing?</strong> Use <em>New</em> to start from a blank slate or <em>Load…</em> to open a saved protocol.</li>
              <li><strong>Insert commands safely:</strong> Click <em>Insert Command</em> for a guided form, or pick a starter flow from <em>Templates</em>.</li>
              <li><strong>Annotate:</strong> Add comments with <code>//</code> to explain study logic for collaborators.</li>
              <li><strong>Validate often:</strong> Leave <em>Auto validate</em> toggled on or press <em>Validate now</em> after large edits.</li>
              <li><strong>Review results:</strong> Jump between issues with the navigation arrows, resolve them, and re-run validation.</li>
            </ol>
            <div class="back-to-top"><a href="#manualTop">Back to top ↑</a></div>
          </section>

          <section id="manual-authoring">
            <h2>Editor essentials</h2>
            <ul>
              <li><strong>Command palette:</strong> The Recognized commands list groups syntax by category. Click any chip to open the insert dialog pre-filtered for that command.</li>
              <li><strong>Suggestion bar:</strong> Keep an eye on inline hints that remind you of required segments or recommended formats.</li>
              <li><strong>Ghost preview:</strong> As you type, the ghost line shows the best completion for quick tab acceptance.</li>
              <li><strong>Manual &amp; About:</strong> The toolbar links launch reference material in-place so you can look up behavior without leaving the editor.</li>
              <li><strong>Spacing helpers:</strong> Template insertion automatically adds blank lines and explanatory comments to keep files legible.</li>
            </ul>
            <div class="back-to-top"><a href="#manualTop">Back to top ↑</a></div>
          </section>

          <section id="manual-saving">
            <h2>Save &amp; share</h2>
            <ul>
              <li><strong>Save locally:</strong> Use <em>Save</em> to overwrite or <em>Download</em> to grab a fresh <code>.txt</code> copy.</li>
              <li><strong>Version control:</strong> Commit the exported text to git alongside study documentation for traceable changes.</li>
              <li><strong>Resource folders:</strong> Keep media assets (HTML, audio, video, imagery) in a parallel <code>resources</code> directory so Android devices can access them.</li>
            </ul>
            <div class="back-to-top"><a href="#manualTop">Back to top ↑</a></div>
          </section>

          <section id="manual-android">
            <h2>Run your protocol on Android</h2>
            <ol>
              <li><strong>Export from the editor:</strong> Download the finalized protocol and gather any referenced assets (HTML, audio, video, images).</li>
              <li><strong>Transfer to the device:</strong> Copy the protocol text file and the resources folder to your Android tablet/phone via USB, cloud storage, or shared drive. Keep them in a clearly named directory.</li>
              <li><strong>Open PoLA:</strong> On the device, launch Pocket Lab App. From the home screen choose <em>Load Protocol</em> and select the exported text file.</li>
              <li><strong>Link resources:</strong> If your study references media, tap <em>Select resources folder</em> and point PoLA to the transferred assets directory.</li>
              <li><strong>Verify &amp; start:</strong> Confirm the protocol name, participant ID, and optional options, then press <em>Start Study</em>. PoLA runs exactly what you authored online.</li>
            </ol>
            <div class="callout"><strong>Tip:</strong> Re-run validation in the editor whenever you make a change. Consistent formatting and comments make on-device troubleshooting faster.</div>
            <div class="back-to-top"><a href="#manualTop">Back to top ↑</a></div>
          </section>

          <section id="manual-command-reference">
            <h2>Protocol command manual</h2>
            <p>This reference describes every command the runtime understands. Protocols are plain-text files encoded in UTF-8. Each non-empty line represents one command. Values are separated with semicolons (<code>;</code>). Lines beginning with <code>//</code> are comments and ignored during execution.</p>

            <div class="callout">
              <strong>Quick tips:</strong>
              <ul>
                <li>Wrap values containing semicolons inside quotation marks (<code>"value;with;semicolons"</code>) or use square brackets.</li>
                <li>Resource references (images, audio) should match the filenames stored in your project resources.</li>
                <li>Commands are case-insensitive, but the conventional style is UPPERCASE.</li>
                <li>Media placeholders such as <code>&lt;audio.mp3&gt;</code>, <code>&lt;video.mp4,60&gt;</code>, or <code>&lt;custom.html&gt;</code> can be embedded in most text fields.</li>
              </ul>
            </div>

            <nav class="quick-links" aria-label="Manual shortcuts">
              <strong>Sections:</strong>
              <ul>
                <li><a href="#manual-flow">Study metadata &amp; flow control</a></li>
                <li><a href="#manual-content">Instructional &amp; survey content</a></li>
                <li><a href="#manual-media">Media &amp; interaction helpers</a></li>
                <li><a href="#manual-layout">Layout &amp; styling commands</a></li>
                <li><a href="#manual-practices">Best practices</a></li>
              </ul>
            </nav>

            <details id="manual-flow" open>
              <summary>Study metadata &amp; flow control</summary>
              <dl class="commands">
                <dt id="manual-cmd-study-id"><code>STUDY_ID;identifier</code></dt>
                <dd>Defines a unique identifier stored in exports and logs, helping you group sessions that belong to the same protocol version. Only one <code>STUDY_ID</code> is allowed per file.<br><strong>Example:</strong> <code>STUDY_ID;POLA_FIELD_STUDY_01</code></dd>

                <dt id="manual-cmd-label"><code>LABEL;Name</code></dt>
                <dd>Marks a jump target. Labels are case-sensitive and should avoid spaces where possible. Duplicate labels trigger validation errors.<br><strong>Example:</strong> <code>LABEL;INTRO_COMPLETED</code></dd>

                <dt id="manual-cmd-goto"><code>GOTO;LabelName</code></dt>
                <dd>Transfers execution to the line immediately after the labeled command. Use this to branch participants based on earlier responses.<br><strong>Example:</strong> <code>GOTO;FOLLOW_UP_BRANCH</code></dd>

                <dt id="manual-cmd-log"><code>LOG;message</code></dt>
                <dd>Writes a custom entry to the session log without presenting UI. Useful for marking experimental phases, counterbalancing groups, or debugging.<br><strong>Example:</strong> <code>LOG;Condition=A</code></dd>

                <dt id="manual-cmd-randomize"><code>RANDOMIZE_ON</code> &hellip; <code>RANDOMIZE_OFF</code></dt>
                <dd>Wraps a block of commands that should be presented in randomized order. Ensure every <code>RANDOMIZE_ON</code> has a matching <code>RANDOMIZE_OFF</code>. Nested randomization is not permitted.</dd>

                <dt id="manual-cmd-transitions"><code>TRANSITIONS;mode</code></dt>
                <dd>Controls screen-to-screen animations. Accepted modes: <code>off</code>, <code>slide</code>, <code>slideleft</code>, <code>fade</code>, <code>dissolve</code>.<br><strong>Example:</strong> <code>TRANSITIONS;slide</code></dd>

                <dt id="manual-cmd-end"><code>END</code></dt>
                <dd>Terminates the protocol immediately and shows the completion screen. Avoid trailing parameters.</dd>
              </dl>
            </details>

            <details id="manual-content" open>
              <summary>Instructional &amp; survey content</summary>
              <dl class="commands">
                <dt id="manual-cmd-instruction"><code>INSTRUCTION;Header;Body;Continue text</code></dt>
                <dd>Displays a formatted instruction page. Body text can include HTML, media placeholders, and accessibility modifiers like <code>[TAP]</code> or <code>[HOLD]</code> (attach to the continue text).<br><strong>Example:</strong> <code>INSTRUCTION;Welcome;&lt;b&gt;Please read carefully.&lt;/b&gt;;Start</code></dd>

                <dt id="manual-cmd-html"><code>HTML;file.html;Continue text</code></dt>
                <dd>Loads an HTML file from the resources folder and renders it inside the study screen, preserving layouts and embedded media.<br><strong>Example:</strong> <code>HTML;consent_form.html;I agree</code></dd>

                <dt id="manual-cmd-inputfield"><code>INPUTFIELD;Header;Body;[Field1;Field2;…];Continue text</code></dt>
                <dd>Collects free-text responses. Fields can be listed inline (<code>Field1;Field2</code>) or wrapped in brackets to include semicolons within labels. Append <code>[HOLD]</code> to the continue caption to require a long press.<br><strong>Example:</strong> <code>INPUTFIELD;Background survey;Tell us about yourself;[Age;Occupation;City];Continue</code></dd>

                <dt id="manual-cmd-inputfield-rand"><code>INPUTFIELD[RANDOMIZED]</code></dt>
                <dd>Presents the listed input fields in a randomized order while keeping header, body, and continue text fixed.</dd>

                <dt id="manual-cmd-scale"><code>SCALE;Header;Body;Item label;Response1;…</code></dt>
                <dd>Shows a single-item scale with tap targets. Responses may include optional branch labels in square brackets. <code>Response text[Label]</code> directs flow to a matching <code>LABEL</code> when selected.<br><strong>Example:</strong> <code>SCALE;Mood check;How do you feel now?;Mood;Very low;Low;Neutral;High;Very high</code></dd>

                <dt id="manual-cmd-scale-rand"><code>SCALE[RANDOMIZED]</code></dt>
                <dd>Randomizes the order of response options to reduce order effects. Branch labels remain attached to their original response text.</dd>

                <dt id="manual-cmd-timer"><code>TIMER;Header;Body;Seconds;Continue text</code></dt>
                <dd>Displays a countdown timer. When the timer reaches zero, participants may proceed using the continue button (or immediately if you specify <code>0</code> seconds).<br><strong>Example:</strong> <code>TIMER;Break;Rest for one minute;60;Resume task</code></dd>
              </dl>
            </details>

            <details id="manual-media" open>
              <summary>Media &amp; interaction helpers</summary>
              <dl class="commands">
                <dt id="manual-cmd-timer-sound"><code>TIMER_SOUND;file.mp3</code></dt>
                <dd>Sets the audio file used by subsequent <code>TIMER</code> screens. Place the referenced file in the resources folder. Optional volume can follow the filename (e.g., <code>file.mp3,70</code>).</dd>

                <dt id="manual-cmd-resources"><code>&lt;resource placeholders&gt;</code></dt>
                <dd>Within any textual field you can embed:
                  <ul>
                    <li><code>&lt;audio.mp3,80&gt;</code> — plays audio at 80% volume.</li>
                    <li><code>&lt;video.mp4,60&gt;</code> — plays video at 60% volume (0–100).</li>
                    <li><code>&lt;image.jpg&gt;</code> — displays an inline image.</li>
                    <li><code>&lt;custom.html&gt;</code> — injects HTML content into instruction screens.</li>
                  </ul>
                </dd>
              </dl>
            </details>

            <details id="manual-layout" open>
              <summary>Layout &amp; styling commands</summary>
              <p>Apply these commands before the screens you want to style. Settings remain active until changed again or reset via another command.</p>
              <dl class="commands">
                <dt><code>HEADER_SIZE;value</code></dt>
                <dd>Sets header text size (SP). <strong>Accepted values:</strong> decimal numbers such as <code>24</code>.</dd>

                <dt><code>BODY_SIZE;value</code></dt>
                <dd>Adjusts body text size (SP). <strong>Accepted values:</strong> decimal numbers.</dd>

                <dt><code>ITEM_SIZE;value</code></dt>
                <dd>Controls the size of scale item labels. <strong>Accepted values:</strong> decimal numbers.</dd>

                <dt><code>RESPONSE_SIZE;value</code></dt>
                <dd>Changes response button text size. <strong>Accepted values:</strong> decimal numbers.</dd>

                <dt><code>CONTINUE_SIZE;value</code></dt>
                <dd>Updates the continue button text size. <strong>Accepted values:</strong> decimal numbers.</dd>

                <dt><code>TIMER_SIZE;value</code></dt>
                <dd>Sets the countdown digits size. <strong>Accepted values:</strong> decimal numbers.</dd>

                <dt><code>HEADER_ALIGNMENT;LEFT|CENTER|RIGHT</code></dt>
                <dd>Aligns header text horizontally. <strong>Accepted values:</strong> keywords <code>LEFT</code>, <code>CENTER</code>, or <code>RIGHT</code>.</dd>

                <dt><code>BODY_ALIGNMENT;LEFT|CENTER|RIGHT</code></dt>
                <dd>Aligns body copy. <strong>Accepted values:</strong> <code>LEFT</code>, <code>CENTER</code>, <code>RIGHT</code>.</dd>

                <dt><code>CONTINUE_ALIGNMENT;Horizontal;Vertical</code></dt>
                <dd>Places the continue button. <strong>Accepted values:</strong> horizontal keyword (<code>LEFT</code>, <code>CENTER</code>, <code>RIGHT</code>) plus vertical keyword (<code>TOP</code> or <code>BOTTOM</code>).</dd>

                <dt><code>TIMER_ALIGNMENT;LEFT|CENTER|RIGHT</code></dt>
                <dd>Aligns the timer component. <strong>Accepted values:</strong> <code>LEFT</code>, <code>CENTER</code>, <code>RIGHT</code>.</dd>

                <dt><code>HEADER_COLOR;#RRGGBB</code></dt>
                <dd>Sets header text color. <strong>Accepted values:</strong> hex codes (e.g., <code>#FF0055</code>) or HTML color names.</dd>

                <dt><code>BODY_COLOR;#RRGGBB</code></dt>
                <dd>Sets body text color. <strong>Accepted values:</strong> hex codes or HTML names.</dd>

                <dt><code>RESPONSE_TEXT_COLOR;#RRGGBB</code></dt>
                <dd>Colors the response text. <strong>Accepted values:</strong> hex codes or HTML names.</dd>

                <dt><code>RESPONSE_BACKGROUND_COLOR;#RRGGBB</code></dt>
                <dd>Colors the background of response buttons. <strong>Accepted values:</strong> hex codes or HTML names.</dd>

                <dt><code>SCREEN_BACKGROUND_COLOR;#RRGGBB</code></dt>
                <dd>Sets the entire screen background. <strong>Accepted values:</strong> hex codes or HTML names.</dd>

                <dt><code>CONTINUE_TEXT_COLOR;#RRGGBB</code></dt>
                <dd>Sets continue button text color. <strong>Accepted values:</strong> hex codes or HTML names.</dd>

                <dt><code>CONTINUE_BACKGROUND_COLOR;#RRGGBB</code></dt>
                <dd>Sets continue button background color. <strong>Accepted values:</strong> hex codes or HTML names.</dd>

                <dt><code>TIMER_COLOR;#RRGGBB</code></dt>
                <dd>Sets timer digits color. <strong>Accepted values:</strong> hex codes or HTML names.</dd>
              </dl>
            </details>

            <details id="manual-practices" open>
              <summary>Best practices</summary>
              <ul>
                <li><strong>Validate early:</strong> Use the in-app protocol validator to catch missing labels, malformed commands, or resource mismatches.</li>
                <li><strong>Use comments:</strong> Prefix lines with <code>//</code> to annotate sections or disable commands temporarily.</li>
                <li><strong>Back up resources:</strong> Store referenced media inside the PoLA resources folder so sessions remain consistent across devices.</li>
                <li><strong>Version your scripts:</strong> Pair each public release with a tagged protocol file and bump <code>STUDY_ID</code> as you iterate.</li>
              </ul>
            </details>

            <div class="back-to-top"><a href="#manualTop">Back to top ↑</a></div>
          </section>

          <section id="manual-license">
            <h2>License &amp; data policy</h2>
            <ul>
              <li><strong>Open source:</strong> PoLA is distributed under the <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GNU GPLv3</a>. Share improvements under the same license and retain attribution.</li>
              <li><strong>Local-first data:</strong> Protocols, responses, and logs stay on the device or storage location you choose. Nothing is transmitted elsewhere unless you export or synchronize it yourself.</li>
              <li><strong>Use at your own risk:</strong> The software is provided <em>as is</em> with no warranties. Validate your study setup, supervise deployments, and follow institutional, legal, and ethical requirements.</li>
              <li><strong>Commercial or clinical use:</strong> Coordinate with the maintainers via <a href="mailto:lkacz@amu.edu.pl">lkacz@amu.edu.pl</a> before pursuing non-research deployments.</li>
            </ul>
            <div class="back-to-top"><a href="#manualTop">Back to top ↑</a></div>
          </section>

          <section id="manual-support">
            <h2>Support</h2>
            <p>Questions, collaboration ideas, or bug reports are welcome at <a href="mailto:lkacz@amu.edu.pl">lkacz@amu.edu.pl</a>. Contributions from the community—new commands, UI refinements, translations—are encouraged under the GNU GPLv3 license.</p>
            <div class="back-to-top"><a href="#manualTop">Back to top ↑</a></div>
          </section>

          <footer>
            <p>For comprehensive documentation, including data export formats and developer guides, visit the project repository: <a href="https://github.com/lkacz/PocketLabApp" target="_blank" rel="noopener">github.com/lkacz/PocketLabApp</a>.</p>
            <p>Thank you for exploring PoLA. We hope these tools help you run precise, participant-friendly studies wherever your research takes you.</p>
          </footer>
        </div>
      </article>
    </dialog>

    <script defer src="main.js"></script>
  </body>
</html>
